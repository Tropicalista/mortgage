(()=>{"use strict";var t;function e(e,r,s,a,n){void 0===a&&(a=0),void 0===n&&(n=t.End);var i=0===e,o=Math.pow(1+e,r),m=n===t.Begin?1:0,h=i?1:e;return-(a+s*o)/(i?r:(1+h*m)*(o-1)/h)}function r(r,s,a,n,i,o){if(void 0===i&&(i=0),void 0===o&&(o=t.End),s<1)return Number.NaN;if(o===t.Begin&&1===s)return 0;var m=function(e,r,s,a,n){return function(e,r,s,a,n){if(void 0===n&&(n=t.End),0===e)return-(a+s*r);var i=Math.pow(1+e,r);return-a*i-s*(1+e*(n===t.Begin?1:0))/e*(i-1)}(e,r-1,s,a,n)}(r,s,e(r,a,n,i,o),n,o)*r;return o===t.Begin&&s>1&&(m/=1+r),m}!function(t){t.Begin="begin",t.End="end"}(t||(t={}));const s=window.wp.i18n,a=window.navigator.language||window.navigator.userLanguage,n=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),m=document.createElement("table");class h{constructor(t){this.frequency=12,this.setFormInput(t),this.currency="<small>"+t.dataset.currency+"</small>",this.showSummary="true"===t.dataset.yearsummary,this.showTable="true"===t.dataset.showtable,this.type=t.dataset.type}setFormInput(t){const e=new FormData(t);for(const[t,r]of e)this[t]=parseFloat(r);this.rate=this.rate/100}payment(){return-1*e(this.rate/this.frequency,this.frequency*this.term,this.amount)}summary(){return"<p>"+(0,s.__)("Loan amount","mortgage")+": <b>"+this.formatNumber(this.amount)+"</b><br />"+(0,s.__)("Interest rate","mortgage")+": <b>"+(100*this.rate).toFixed(2)+"%</b><br />"+(0,s.__)("Number of payments","mortgage")+": <b>"+this.term*this.frequency+"</b><br />"+(0,s.__)("Recurring payment","mortgage")+": <b>"+this.formatNumber(this.result)+"</b><br />"+(0,s.__)("Total paid","mortgage")+": <b>"+this.formatNumber(this.result*this.term*this.frequency)+"</b></p>"}generateTable(t){for(const e of t){const t=m.insertRow();this.showSummary&&this.yearSummary(e["#"]);for(const r in e)t.insertCell().innerHTML=e[r]}}generateTableHead(t){const e=m.createTHead().insertRow();for(const r of t){const t=document.createElement("th"),s=document.createTextNode(r);t.appendChild(s),e.appendChild(t)}}yearSummary(t){if(0!=t%this.frequency)return;const e=this.ipmts.slice(0,t);let r="";const a=Number(t/this.frequency);r+=(0,s.__)("Total after year ","mortgage")+a+": "+this.formatNumber(this.result*this.frequency*a),r+="<br>"+(0,s.__)("Interests paid after year ","mortgage")+a+": "+this.formatNumber(-1*e.reduce(((t,e)=>t+e),0));const n=m.insertRow(-1).insertCell(0);n.innerHTML=r,n.colSpan=5}mortgageTable(){const t=[],e=["#",(0,s.__)("Installment","mortgage"),(0,s.__)("Interest","mortgage"),(0,s.__)("Principal","mortgage"),(0,s.__)("Balance","mortgage")];this.periods=this.getPeriods(),this.ipmts=this.periods.map((t=>r(this.rate/this.frequency,t,1*this.periods.length,this.amount)));let a=this.amount;for(let e=0;e<this.ipmts.length;e++)a=a-this.result-this.ipmts[e],t.push({"#":e+1,payment:this.formatNumber(this.result),interest:this.formatNumber(-1*this.ipmts[e]),principal:this.formatNumber(this.result+this.ipmts[e]),balance:this.formatNumber(a)});m.innerHTML="",this.generateTableHead(e),this.generateTable(t)}loanResponse(t){t.closest(".wp-block-columns")&&(t=t.parentNode.parentNode),this.result=this.payment(),n.className="wp-block-mortgage-result success",n.innerHTML="<p>"+(0,s.__)("Installment","mortgage")+": <b>"+this.formatNumber(this.result)+"</b></p>",i.className="wp-block-mortgage-summary",i.innerHTML=this.summary(),this.showTable&&(this.mortgageTable(t),o.className="wp-block-mortgage-table",o.appendChild(m),t.after(o)),t.after(i),t.after(n),n.scrollIntoView({behavior:"smooth"})}durationResponse(t){t.closest(".wp-block-columns")&&(t=t.parentNode.parentNode);const e=[(0,s.__)("Duration","mortgage"),(0,s.__)("Installment","mortgage"),(0,s.__)("Interests","mortgage"),(0,s.__)("Total","mortgage")],r=[];[10,15,20,25,30,35,40].forEach((t=>{this.term=t,r.push({years:t+(0,s.__)(" Years","mortgage"),recurring:this.formatNumber(this.payment()),interests:this.formatNumber(this.payment()*this.frequency*t-this.amount),total:this.formatNumber(this.payment()*this.frequency*t)})})),m.innerHTML="",this.generateTableHead(e),this.generateTable(r),n.className="wp-block-mortgage-table",n.appendChild(m),t.after(n),n.scrollIntoView({behavior:"smooth"})}ratesResponse(t){this.increment=parseFloat(t.querySelector('[name="increment"]').value/100),t.closest(".wp-block-columns")&&(t=t.parentNode.parentNode);const e=[(0,s.__)("Rate","mortgage"),(0,s.__)("Installment","mortgage"),(0,s.__)("Interests","mortgage"),(0,s.__)("Total","mortgage")],r=[],a=this.rate;[0,1,2,3,4,5,6,7,8].forEach((t=>{this.rate=a+this.increment*t,r.push({rate:(100*this.rate).toFixed(2)+"<small>%</small>",recurring:this.formatNumber(this.payment()),interests:this.formatNumber(12*this.payment()*this.term-this.amount),total:this.formatNumber(12*this.payment()*this.term)})})),m.innerHTML="",this.generateTableHead(e),this.generateTable(r),n.className="wp-block-mortgage-table",n.appendChild(m),t.after(n),n.scrollIntoView({behavior:"smooth"})}response(t){switch(this.type){case"loan":default:this.loanResponse(t);break;case"rates":this.ratesResponse(t);break;case"duration":this.durationResponse(t)}}getPeriods(){const t=Array.from(Array(this.term*this.frequency).keys());return t.shift(),t.push(t.slice(-1).pop()+1),t}formatNumber(t){return this.currency+t.toLocaleString(a,{minimumFractionDigits:2,maximumFractionDigits:2})}}document.addEventListener("submit",(function(t){const e=t.target;e.className.indexOf("wp-block-mortgage-form")<0||(t.preventDefault(),t.stopPropagation(),e.reportValidity()&&new h(e).response(e))}),!0)})();